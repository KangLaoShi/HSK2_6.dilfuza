<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á¨¨6ËØæÔºö‰Ω†ÊÄé‰πà‰∏çÂêÉ‰∫Ü - HSK 2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 3D Flip Card Utilities */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .transition-transform { transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1); }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f0fdf4; }
        ::-webkit-scrollbar-thumb { background: #86efac; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #22c55e; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in { animation: fadeIn 0.3s ease-in; }

        .active-tab { 
            border-bottom-color: #fde047 !important; 
            background-color: #166534 !important; 
        }
    </style>
</head>
<body class="bg-green-50 text-gray-800 font-sans h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-green-800 text-white p-3 sm:p-4 shadow-md z-10 text-center shrink-0">
        <h1 class="text-xl sm:text-3xl font-bold m-0">Á¨¨6ËØæÔºö‰Ω†ÊÄé‰πà‰∏çÂêÉ‰∫Ü</h1>
        <p class="mt-1 text-green-200 text-xs sm:text-base">Lesson 6: Nega buncha kam yeysan?</p>
        <p class="mt-1 sm:mt-2 text-yellow-300 text-xs sm:text-base font-bold tracking-wide">Dilfuza KƒÅng l«éo shƒ´ bilan xitoy tilini o'rganmiz</p>
    </header>

    <!-- Navigation (Flex Wrap for Mobile) -->
    <nav class="bg-green-500 flex flex-wrap shadow-sm z-10 shrink-0 text-sm sm:text-base">
        <button onclick="switchTab('flashcards')" id="btn-flashcards" class="nav-btn flex-1 py-2 sm:py-3 px-1 text-white font-semibold hover:bg-green-600 transition-colors border-b-4 border-transparent active-tab whitespace-nowrap">ÁîüËØçÈó™Âç°</button>
        <button onclick="switchTab('dialogues')" id="btn-dialogues" class="nav-btn flex-1 py-2 sm:py-3 px-1 text-white font-semibold hover:bg-green-600 transition-colors border-b-4 border-transparent whitespace-nowrap">ÂØπËØùÂÜÖÂÆπ</button>
        <button onclick="switchTab('grammar')" id="btn-grammar" class="nav-btn flex-1 py-2 sm:py-3 px-1 text-white font-semibold hover:bg-green-600 transition-colors border-b-4 border-transparent whitespace-nowrap">ËØ≠Ê≥ïËß£Èáä</button>
        <button onclick="switchTab('vocab-test')" id="btn-vocab-test" class="nav-btn flex-1 py-2 sm:py-3 px-1 text-white font-semibold hover:bg-green-600 transition-colors border-b-4 border-transparent whitespace-nowrap">ÁîüËØçÊµãËØï</button>
        <button onclick="switchTab('comp-test')" id="btn-comp-test" class="nav-btn flex-1 py-2 sm:py-3 px-1 text-white font-semibold hover:bg-green-600 transition-colors border-b-4 border-transparent whitespace-nowrap">ÁªºÂêàÊµãËØï</button>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto p-4 sm:p-8 relative" id="main-content">
        
        <!-- Flashcards Section -->
        <section id="flashcards" class="tab-section h-full flex flex-col items-center justify-center max-w-2xl mx-auto animate-fade-in">
            <div id="flashcard-counter" class="text-green-800 font-bold mb-4 text-lg"></div>
            
            <!-- Card dimension designed for mobile friendliness (aspect-ratio 4:5) -->
            <div class="perspective-1000 w-[90%] max-w-[340px] aspect-[4/5] sm:aspect-auto sm:h-80 mx-auto cursor-pointer" onclick="toggleFlip()">
                <div id="flashcard-inner" class="relative w-full h-full transition-transform transform-style-3d shadow-xl rounded-2xl">
                    <!-- Front -->
                    <div class="absolute w-full h-full backface-hidden bg-white border-4 border-green-500 rounded-2xl flex flex-col items-center justify-center p-6 text-center">
                        
                        <!-- Speaker Button -->
                        <button onclick="playCurrentFlashcardAudio(event)" class="absolute top-3 right-3 text-green-500 hover:text-green-700 p-2 rounded-full hover:bg-green-50 transition-colors z-10" title="Tinglash (Play)">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5 10v4a2 2 0 002 2h2.586l3.707 3.707a1 1 0 001.707-.707V5.414a1 1 0 00-1.707-.707L9.586 10H7a2 2 0 00-2 2z" />
                            </svg>
                        </button>

                        <!-- Centered Content -->
                        <div id="fc-zh" class="text-7xl sm:text-8xl font-bold text-green-800 mb-2"></div>
                        <div id="fc-py" class="text-2xl sm:text-3xl text-gray-500"></div>

                        <div class="text-sm text-gray-400 absolute bottom-4 w-full text-center">(Aylantirish uchun bosing)</div>
                    </div>
                    <!-- Back -->
                    <div class="absolute w-full h-full backface-hidden bg-green-100 border-4 border-green-600 rounded-2xl flex flex-col items-center justify-center p-6 text-center rotate-y-180">
                        <div id="fc-uz" class="text-3xl sm:text-4xl font-bold text-green-900 leading-tight"></div>
                    </div>
                </div>
            </div>

            <div class="flex gap-4 mt-8 w-[90%] max-w-[340px]">
                <button id="btn-prev" onclick="prevCard()" class="flex-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-bold py-3 px-4 rounded-lg shadow transition-colors">&larr; Oldingi</button>
                <button id="btn-next" onclick="nextCard()" class="flex-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-bold py-3 px-4 rounded-lg shadow transition-colors">Keyingi &rarr;</button>
            </div>
        </section>

        <!-- Dialogues Section -->
        <section id="dialogues" class="tab-section hidden max-w-3xl mx-auto pb-10">
            <!-- Injected via JS -->
        </section>

        <!-- Grammar Section -->
        <section id="grammar" class="tab-section hidden max-w-3xl mx-auto pb-10">
            <!-- Injected via JS -->
        </section>

        <!-- Vocab Test Section -->
        <section id="vocab-test" class="tab-section hidden max-w-xl mx-auto pb-10">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-green-800">ÁîüËØçÊµãËØï (Vocabulary Test)</h2>
            </div>
            <div id="vocab-test-container">
                <!-- Quiz Injected via JS -->
            </div>
        </section>

        <!-- Comp Test Section -->
        <section id="comp-test" class="tab-section hidden max-w-xl mx-auto pb-10">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-green-800">ÁªºÂêàÊµãËØï (Grammar & Comp Test)</h2>
            </div>
            <div id="comp-test-container">
                <!-- Quiz Injected via JS -->
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-400 text-center p-3 text-sm shrink-0">
        <p class="mb-1 text-gray-300">HSK 2 Standard Course - Lesson 6</p>
        <p>&copy; 2026 Dilfuza KƒÅng l«éo shƒ´ (telegram@diffila)</p>
    </footer>

    <script>
        // --- Data Definitions ---
        const vocabData = [
            {zh: 'Èó®', py: 'm√©n', uz: 'darvoza, eshik'},
            {zh: 'Â§ñ', py: 'w√†i', uz: 'tashqarida'},
            {zh: 'Ëá™Ë°åËΩ¶', py: 'z√¨x√≠ngchƒì', uz: 'velosiped'},
            {zh: 'ÁæäËÇâ', py: 'y√°ngr√≤u', uz: "qo'y go'shti"},
            {zh: 'Â•ΩÂêÉ', py: 'h«éochƒ´', uz: 'shirin, mazali'},
            {zh: 'Èù¢Êù°', py: 'mi√†nti√°o', uz: "lag'mon"},
            {zh: 'ÊâìÁØÆÁêÉ', py: 'd«é l√°nqi√∫', uz: "basketbol o'ynamoq"},
            {zh: 'Âõ†‰∏∫', py: 'yƒ´nw√®i', uz: 'chunki'},
            {zh: 'ÊâÄ‰ª•', py: 'su«íy«ê', uz: 'shuning uchun'},
            {zh: 'Ê∏∏Ê≥≥', py: 'y√≥u y«íng', uz: 'suzish'},
            {zh: 'ÁªèÂ∏∏', py: 'jƒ´ngch√°ng', uz: 'odatda; tez-tez'},
            {zh: 'ÂÖ¨Êñ§', py: 'g≈çngjƒ´n', uz: 'kilogramm'},
            {zh: 'ÂßêÂßê', py: 'jiƒõjie', uz: 'opa'}
        ];

        const dialoguesData = [
            {
                title: "1. Âú®Â≠¶Ê†° Maktabda",
                lines: [
                    {s: 'A', zh: '‰Ω†Áü•ÈÅìÂ∞èÁéã‰ªäÂ§©‰ªÄ‰πàÊó∂ÂÄôÊù•Â≠¶Ê†°Âêó?', py: 'N«ê zhƒ´d√†o Xi«éo W√°ng jƒ´ntiƒÅn sh√©nme sh√≠hou l√°i xu√©xi√†o ma?', uz: 'Siao Vang bugun maktabga qachon kelishini bilasanmi?', ru: '–¢—ã –∑–Ω–∞–µ—à—å, –∫–æ–≥–¥–∞ –°—è–æ –í–∞–Ω —Å–µ–≥–æ–¥–Ω—è –ø—Ä–∏–¥–µ—Ç –≤ —à–∫–æ–ª—É?', en: 'Do you know what time Xiao Wang is coming to school today?'},
                    {s: 'B', zh: '‰ªñÂ∑≤ÁªèÊù•‰∫Ü„ÄÇ', py: 'TƒÅ y«êjƒ´ng l√°i le.', uz: 'U allaqachon kelgan.', ru: '–û–Ω —É–∂–µ –ø—Ä–∏—à–µ–ª.', en: 'He has already arrived.'},
                    {s: 'A', zh: '‰Ω†ÊÄé‰πàÁü•ÈÅì‰ªñÊù•‰∫Ü?', py: 'N«ê zƒõnme zhƒ´d√†o tƒÅ l√°i le?', uz: 'Uni kelganini sen qayerdan bilding?', ru: '–û—Ç–∫—É–¥–∞ —Ç—ã –∑–Ω–∞–µ—à—å, —á—Ç–æ –æ–Ω –ø—Ä–∏—à–µ–ª?', en: 'How do you know he is here?'},
                    {s: 'B', zh: 'ÊàëÂú®Èó®Â§ñÁúãËßÅ‰ªñÁöÑËá™Ë°åËΩ¶‰∫Ü„ÄÇ', py: 'W«í z√†i m√©n w√†i k√†nji√†n tƒÅ de z√¨x√≠ngchƒì le.', uz: "Darvoza oldida uning velosipedini ko'rdim.", ru: '–Ø –≤–∏–¥–µ–ª –µ–≥–æ –≤–µ–ª–æ—Å–∏–ø–µ–¥ –∑–∞ –¥–≤–µ—Ä—å—é (–Ω–∞ —É–ª–∏—Ü–µ).', en: 'I saw his bicycle outside the door.'}
                ]
            },
            {
                title: "2. Âú®È•≠È¶Ü Restoranda",
                lines: [
                    {s: 'A', zh: '‰ªäÂ§©ÁöÑÁæäËÇâÂæàÂ•ΩÂêÉ,‰Ω†ÊÄé‰πà‰∏çÂêÉ‰∫Ü?', py: 'Jƒ´ntiƒÅn de y√°ngr√≤u hƒõn h«éochƒ´, n«ê zƒõnme b√π chƒ´ le?', uz: "Bugungi qo'y go'shti juda shirin ekan, sen nega yemading?", ru: '–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è –±–∞—Ä–∞–Ω–∏–Ω–∞ –æ—á–µ–Ω—å –≤–∫—É—Å–Ω–∞—è, –ø–æ—á–µ–º—É —Ç—ã –±–æ–ª—å—à–µ –Ω–µ –µ—à—å?', en: "Today's mutton is very delicious, why aren't you eating anymore?"},
                    {s: 'B', zh: 'Ëøô‰∏™ÊòüÊúüÂ§©Â§©ÈÉΩÂêÉÁæäËÇâ,‰∏çÊÉ≥ÂêÉ‰∫Ü„ÄÇ', py: 'Zh√®ge xƒ´ngqƒ´ tiƒÅntiƒÅn d≈çu chƒ´ y√°ngr√≤u, b√π xi«éng chƒ´ le.', uz: "Shu haftada har kuni qo'y go'shti yedim, yegim kelmayapti.", ru: '–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –µ–º –±–∞—Ä–∞–Ω–∏–Ω—É, –±–æ–ª—å—à–µ –Ω–µ —Ö–æ—á—É.', en: "I've been eating mutton every day this week, I don't want to eat it anymore."},
                    {s: 'A', zh: 'ÈÇ£‰Ω†ËøòÊÉ≥ÂêÉ‰ªÄ‰πà?', py: 'N√† n«ê h√°i xi«éng chƒ´ sh√©nme?', uz: 'Unda nima yeyishni xohlaysan?', ru: '–¢–æ–≥–¥–∞ —á—Ç–æ –µ—â–µ —Ç—ã —Ö–æ—á–µ—à—å –ø–æ–µ—Å—Ç—å?', en: 'Then what else would you like to eat?'},
                    {s: 'B', zh: 'Êù•‰∏ÄÁÇπÂÑøÈù¢Êù°Âêß„ÄÇ', py: 'L√°i y√¨di«énr mi√†nti√°o ba.', uz: "Iltimos, bir oz lag'mon keltiring.", ru: '–ü—Ä–∏–Ω–µ—Å–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ –ª–∞–ø—à–∏.', en: 'Bring some noodles, please.'}
                ]
            },
            {
                title: "3. Âú®ÂÅ•Ë∫´Êàø Fitnes markazida",
                lines: [
                    {s: 'A', zh: 'Êò®Â§©‰Ω†‰ª¨ÊÄé‰πàÈÉΩÊ≤°ÂéªÊâìÁØÆÁêÉ?', py: 'Zu√≥tiƒÅn n«êmen zƒõnme d≈çu m√©i q√π d«é l√°nqi√∫?', uz: "Nimaga kecha basketbol o'ynashga bormadinglar?", ru: '–ü–æ—á–µ–º—É –≤—ã –≤—Å–µ –≤—á–µ—Ä–∞ –Ω–µ –ø–æ—à–ª–∏ –∏–≥—Ä–∞—Ç—å –≤ –±–∞—Å–∫–µ—Ç–±–æ–ª?', en: "Why didn't any of you go play basketball yesterday?"},
                    {s: 'B', zh: 'Âõ†‰∏∫Êò®Â§©‰∏ãÈõ®,ÊâÄ‰ª•Êàë‰ª¨ÈÉΩÊ≤°Âéª„ÄÇÊàëÂéªÊ∏∏Ê≥≥‰∫Ü„ÄÇ', py: 'Yƒ´nw√®i zu√≥tiƒÅn xi√† y«î, su«íy«ê w«ímen d≈çu m√©i q√π. W«í q√π y√≥u y«íng le.', uz: "Chunki kecha yomg'ir yog'gandi, shuning uchun hech kim bormadi. Men cho'milishga bordim.", ru: '–ü–æ—Ç–æ–º—É —á—Ç–æ –≤—á–µ—Ä–∞ —à–µ–ª –¥–æ–∂–¥—å, –ø–æ—ç—Ç–æ–º—É –º—ã –Ω–µ –ø–æ—à–ª–∏. –Ø —Ö–æ–¥–∏–ª –ø–ª–∞–≤–∞—Ç—å.', en: 'Because it rained yesterday, so none of us went. I went swimming.'},
                    {s: 'A', zh: '‰Ω†ÁªèÂ∏∏Ê∏∏Ê≥≥Âêó?', py: 'N«ê jƒ´ngch√°ng y√≥u y«íng ma?', uz: "Sen tez-tez cho'milishga borib turasanmi?", ru: '–¢—ã —á–∞—Å—Ç–æ –ø–ª–∞–≤–∞–µ—à—å?', en: 'Do you swim often?'},
                    {s: 'B', zh: 'Ëøô‰∏™ÊúàÊàëÂ§©Â§©Ê∏∏Ê≥≥,ÊàëÁé∞Âú®‰∏ÉÂçÅÂÖ¨Êñ§‰∫Ü„ÄÇ', py: 'Zh√®ge yu√® w«í tiƒÅntiƒÅn y√≥u y«íng, w«í xi√†nz√†i qƒ´sh√≠ g≈çngjƒ´n le.', uz: "Bu oyda har kuni cho'milishga boryapman, hozir og'irligim 70 kg.", ru: '–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ —è –ø–ª–∞–≤–∞—é –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, —Å–µ–π—á–∞—Å —è –≤–µ—à—É 70 –∫–∏–ª–æ–≥—Ä–∞–º–º–æ–≤.', en: 'I swim every day this month, I am 70 kilograms now.'}
                ]
            },
            {
                title: "4. Âú®ÂäûÂÖ¨ÂÆ§ Ofisda",
                lines: [
                    {s: 'A', zh: 'Ëøô‰∏§Â§©ÊÄé‰πàÊ≤°ÁúãËßÅÂ∞èÂº†?', py: 'Zh√® li«éng tiƒÅn zƒõnme m√©i k√†nji√†n Xi«éo ZhƒÅng?', uz: "Shu ikki kunda Siao Jang ko'rinmadi, biror joyga ketdimi?", ru: '–ü–æ—á–µ–º—É —ç—Ç–∏ –¥–≤–∞ –¥–Ω—è –Ω–µ –≤–∏–¥–Ω–æ –°—è–æ –ß–∂–∞–Ω–∞?', en: 'Why haven\'t I seen Xiao Zhang these past two days?'},
                    {s: 'B', zh: '‰ªñÂéªÂåó‰∫¨‰∫Ü„ÄÇ', py: 'TƒÅ q√π Bƒõijƒ´ng le.', uz: 'U Pekinga ketdi.', ru: '–û–Ω —É–µ—Ö–∞–ª –≤ –ü–µ–∫–∏–Ω.', en: 'He went to Beijing.'},
                    {s: 'A', zh: 'ÂéªÂåó‰∫¨‰∫Ü?ÊòØÂéªÊóÖÊ∏∏Âêó?', py: 'Q√π Bƒõijƒ´ng le? Sh√¨ q√π l«öy√≥u ma?', uz: 'Pekinga ketdi? Sayohatga ketdimi?', ru: '–£–µ—Ö–∞–ª –≤ –ü–µ–∫–∏–Ω? –ü–æ–µ—Ö–∞–ª –ø—É—Ç–µ—à–µ—Å—Ç–≤–æ–≤–∞—Ç—å?', en: 'Went to Beijing? Did he go traveling?'},
                    {s: 'B', zh: '‰∏çÊòØ,Âê¨ËØ¥ÊòØÂéªÁúã‰ªñÂßêÂßê„ÄÇ', py: 'B√∫ sh√¨, tƒ´ngshu≈ç sh√¨ q√π k√†n tƒÅ jiƒõjie.', uz: "Yo'q, eshitishimcha, opasini ko'rishga ketgan.", ru: '–ù–µ—Ç, –≥–æ–≤–æ—Ä—è—Ç, –ø–æ–µ—Ö–∞–ª –Ω–∞–≤–µ—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—à—É—é —Å–µ—Å—Ç—Ä—É.', en: 'No, I heard he went to see his older sister.'}
                ]
            }
        ];

        const grammarData = [
            {
                title: "1. ÁñëÈóÆ‰ª£ËØç‚ÄúÊÄé‰πà‚Äù (‚ÄúÊÄé‰πà‚Äù so'roq olmoshi)",
                descUz: "Biror bir ishning sababi so'ralganda ‚ÄúÊÄé‰πà + fe'l/sifat‚Äù qo'llaniladi. Bunday gap orqali asosan hayrat va taajjub ifodalanadi.",
                descRu: "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ –æ –ø—Ä–∏—á–∏–Ω–µ —á–µ–≥–æ-–ª–∏–±–æ, ¬´ÊÄé‰πà + –≥–ª–∞–≥–æ–ª/–ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ¬ª –≤—ã—Ä–∞–∂–∞–µ—Ç —É–¥–∏–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –∏–∑—É–º–ª–µ–Ω–∏–µ.",
                descEn: "Used to ask about the cause of something, 'ÊÄé‰πà + verb/adjective' indicates surprise or astonishment.",
                examples: ["‰Ω†ÊÄé‰πà‰∏çÈ´òÂÖ¥Ôºü (Nega xafa ko'rinasan?)", "Êò®Â§©‰Ω†‰ª¨ÊÄé‰πàÈÉΩÊ≤°ÂéªÊâìÁØÆÁêÉÔºü (Nimaga kecha basketbol o'ynashga bormadinglar?)"]
            },
            {
                title: "2. ÈáèËØçÁöÑÈáçÂè† (Hisob so'zlarning urg'usi)",
                descUz: "Hisob so'zlarning takrorlanishi 'har biri' degan ma'noni anglatadi. Odatda biror guruhning har bir a'zosini alohida ta'kidlab ko'rsatganda ishlatiladi va hisob so'z takroridan keyin albatta ‚ÄúÈÉΩ‚Äù ravishi qo'yiladi.",
                descRu: "–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —Å—á–µ—Ç–Ω—ã—Ö —Å–ª–æ–≤ –æ–∑–Ω–∞—á–∞–µ—Ç ¬´–∫–∞–∂–¥—ã–π¬ª. –û–Ω–æ –≤—ã–¥–µ–ª—è–µ—Ç –∫–∞–∂–¥–æ–≥–æ —á–ª–µ–Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –≥—Ä—É–ø–ø—ã, –∏ –ø–æ—Å–ª–µ –Ω–µ–≥–æ –æ–±—ã—á–Ω–æ —Å–ª–µ–¥—É–µ—Ç –Ω–∞—Ä–µ—á–∏–µ ¬´ÈÉΩ¬ª.",
                descEn: "Reduplication of measure words means 'every' or 'each'. It highlights every member of a specific group, and the adverb 'ÈÉΩ' usually follows.",
                examples: ["ÂêåÂ≠¶‰ª¨‰∏™‰∏™ÈÉΩÂæàÈ´òÂÖ¥„ÄÇ(Talabalarning har biri juda xursand.)", "Ëøô‰∏™ÊòüÊúüÂ§©Â§©ÈÉΩÂêÉÁæäËÇâ„ÄÇ(Bu haftada har kuni qo'y go'shti yedim.)", "Ë°£Êúç‰ª∂‰ª∂ÈÉΩÂæàÊºÇ‰∫Æ„ÄÇ(Kiyimlarning har biri chiroyli.)"]
            },
            {
                title: "3. ÂÖ≥ËÅîËØç‚ÄúÂõ†‰∏∫...ÊâÄ‰ª•...‚Äù (Sabab bog'lovchilari)",
                descUz: "Sabab bog'lovchilari ishtirokidagi qo'shma gaplarning birinchi qismida sabab, ikkinchi qismida esa natija keladi.",
                descRu: "–í –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö —Å –ø—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Å–æ—é–∑–∞–º–∏ –ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∏—á–∏–Ω—É, –∞ –≤—Ç–æ—Ä–∞—è ‚Äî –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.",
                descEn: "In sentences with causal conjunctions, the first clause states the cause, and the second clause states the result.",
                examples: ["Âõ†‰∏∫Êò®Â§©‰∏ãÈõ®ÔºåÊâÄ‰ª•Êàë‰ª¨ÈÉΩÊ≤°Âéª„ÄÇ(Chunki kecha yomg'ir yog'di, shuning uchun biz bormadik.)", "Âõ†‰∏∫‰ªñÊØèÂ§©Ë∑ëÊ≠•ÔºåÊâÄ‰ª•Ë∫´‰ΩìÂæàÂ•Ω„ÄÇ(Chunki u har kuni yuguradi, shuning uchun sog'lig'i yaxshi.)"]
            }
        ];

        // New Vocab Test Data
        const vocabTestData = [
            {q: '"Èó® (m√©n)" so\'zining o\'zbekcha ma\'nosi nima?', opts: ["tashqarida", "darvoza, eshik", "velosiped", "opa"], ans: 1},
            {q: '"y√°ngr√≤u" qanday tarjima qilinadi?', opts: ["mol go'shti", "tovuq go'shti", "qo'y go'shti", "baliq go'shti"], ans: 2},
            {q: '"Â•ΩÂêÉ (h«éochƒ´)" nimani anglatadi?', opts: ["shirin, mazali", "yomon", "katta", "kichik"], ans: 0},
            {q: '"suzish" so\'zining xitoychasi qaysi?', opts: ["Ë∑ëÊ≠• (p«éob√π)", "Ê∏∏Ê≥≥ (y√≥u y«íng)", "ÊâìÁØÆÁêÉ (d«é l√°nqi√∫)", "Ë∏¢Ë∂≥ÁêÉ (tƒ´ z√∫qi√∫)"], ans: 1},
            {q: '"velosiped" xitoy tilida qanday yoziladi?', opts: ["Ëá™Ë°åËΩ¶", "Ê±ΩËΩ¶", "ÁÅ´ËΩ¶", "È£ûÊú∫"], ans: 0},
            {q: '"ÁªèÂ∏∏ (jƒ´ngch√°ng)" so\'zining ma\'nosi nima?', opts: ["hech qachon", "ba'zan", "odatda; tez-tez", "doimo"], ans: 2},
            {q: '"opa" degan ma\'noni bildiruvchi so\'z qaysi?', opts: ["Âì•Âì• (gƒìge)", "ÂºüÂºü (d√¨di)", "Â¶πÂ¶π (m√®imei)", "ÂßêÂßê (jiƒõjie)"], ans: 3},
            {q: '"kilogramm" xitoychada qanday aytiladi?', opts: ["ÂÖ¨Èáå (g≈çngl«ê)", "ÂÖ¨Êñ§ (g≈çngjƒ´n)", "‰∏™ (g√®)", "‰ª∂ (ji√†n)"], ans: 1},
            {q: '"chunki" ma\'nosini bildiruvchi so\'z qaysi?', opts: ["ÊâÄ‰ª• (su«íy«ê)", "Âõ†‰∏∫ (yƒ´nw√®i)", "ÊÄé‰πà (zƒõnme)", "‰ªÄ‰πà (sh√©nme)"], ans: 1},
            {q: '"shuning uchun" xitoy tilida nima deyiladi?', opts: ["ÊâÄ‰ª• (su«íy«ê)", "Âõ†‰∏∫ (yƒ´nw√®i)", "ÊÄé‰πà (zƒõnme)", "‰ªÄ‰πà (sh√©nme)"], ans: 0}
        ];

        const compTestData = [
            {q: 'Nega xafa ko\'rinasan? - ‰Ω† ___ ‰∏çÈ´òÂÖ¥Ôºü', opts: ['‰ªÄ‰πà', 'ÊÄé‰πà', 'Âì™ÂÑø', 'Ë∞Å'], ans: 1},
            {q: 'Har bir kiyim chiroyli. - Ë°£Êúç ___ ÈÉΩÂæàÊºÇ‰∫Æ„ÄÇ', opts: ['‰∏™‰∏™', 'Â§©Â§©', '‰ª∂‰ª∂', 'Âπ¥Âπ¥'], ans: 2},
            {q: '___ Êò®Â§©‰∏ãÈõ®ÔºåÊâÄ‰ª•Êàë‰ª¨Ê≤°Âéª„ÄÇ', opts: ['Âõ†‰∏∫', 'ÊâÄ‰ª•', 'ÊÄé‰πà', 'ÁªèÂ∏∏'], ans: 0},
            {q: 'U qachon maktabga kelishini bilasanmi? - ‰Ω†Áü•ÈÅìÂ∞èÁéã‰ªäÂ§© ___ Êù•Â≠¶Ê†°ÂêóÔºü', opts: ['‰ªÄ‰πà', '‰ªÄ‰πàÊó∂ÂÄô', 'ÊÄé‰πà', 'Ë∞Å'], ans: 1},
            {q: 'Bu oyda har kuni cho\'milishga boryapman. - Ëøô‰∏™ÊúàÊàë ___ Ê∏∏Ê≥≥„ÄÇ', opts: ['Â§©Â§©', '‰ª∂‰ª∂', '‰∏™‰∏™', 'Êú¨Êú¨'], ans: 0},
            {q: 'Uni kelganini sen qayerdan bilding? - ‰Ω†ÊÄé‰πàÁü•ÈÅì‰ªñ ___Ôºü', opts: ['Êù•', 'Êù•‰∫Ü', 'Âéª', 'Âéª‰∫Ü'], ans: 1},
            {q: 'Darvoza oldida uning velosipedini ko\'rdim. - ÊàëÂú® ___ ÁúãËßÅ‰ªñÁöÑËá™Ë°åËΩ¶‰∫Ü„ÄÇ', opts: ['Èó®ÂÜÖ', 'Èó®Â§ñ', 'Èó®‰∏ä', 'Èó®‰∏ã'], ans: 1},
            {q: 'Unda nima yeyishni xohlaysan? - ÈÇ£‰Ω† ___ ÊÉ≥ÂêÉ‰ªÄ‰πàÔºü', opts: ['Ëøò', '‰πü', 'ÈÉΩ', 'Âæà'], ans: 0},
            {q: 'Iltimos, bir oz lag\'mon keltiring. - ___ ‰∏ÄÁÇπÂÑøÈù¢Êù°Âêß„ÄÇ', opts: ['Âéª', 'ÂêÉ', 'Êù•', '‰π∞'], ans: 2},
            {q: 'Eshitishimcha, opasini ko\'rishga ketgan. - Âê¨ËØ¥ÊòØÂéª ___ ‰ªñÂßêÂßê„ÄÇ', opts: ['Áúã', 'Âê¨', 'ËØ¥', 'ËØª'], ans: 0}
        ];

        // --- Application State & Logic ---
        let currentFlashcard = 0;
        let isFlipped = false;
        
        // Quiz Engine State
        let currentQuizType = null;
        let quizState = {
            'vocab': { currentIdx: 0, score: 0, answered: false },
            'comp': { currentIdx: 0, score: 0, answered: false }
        };

        // --- Audio Playback ---
        function playAudio(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel(); 
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-CN'; 
                utterance.rate = 0.85; 
                window.speechSynthesis.speak(utterance);
            } else {
                console.warn("Speech Synthesis is not supported in this browser.");
            }
        }

        function playCurrentFlashcardAudio(event) {
            event.stopPropagation(); 
            const text = vocabData[currentFlashcard].zh;
            playAudio(text);
        }

        function init() {
            renderDialogues();
            renderGrammar();
            updateFlashcard();
            
            // Initialize Quizzes quietly
            quizState['vocab'].currentIdx = 0; quizState['vocab'].score = 0;
            quizState['comp'].currentIdx = 0; quizState['comp'].score = 0;
        }

        // Tab Switching Logic
        function switchTab(tabId) {
            // Update buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active-tab'));
            document.getElementById('btn-' + tabId).classList.add('active-tab');
            
            // Update content views
            document.querySelectorAll('.tab-section').forEach(content => {
                content.classList.add('hidden');
                content.classList.remove('animate-fade-in');
            });
            
            const targetSection = document.getElementById(tabId);
            targetSection.classList.remove('hidden');
            void targetSection.offsetWidth; // Trigger reflow
            targetSection.classList.add('animate-fade-in');
            
            // Scroll to top
            document.getElementById('main-content').scrollTop = 0;

            // Trigger Quiz rendering if it's a quiz tab
            if(tabId === 'vocab-test') startQuiz('vocab', false);
            if(tabId === 'comp-test') startQuiz('comp', false);
        }

        // --- Flashcard Logic ---
        function updateFlashcard() {
            const card = vocabData[currentFlashcard];
            document.getElementById('fc-zh').textContent = card.zh;
            document.getElementById('fc-py').textContent = card.py;
            document.getElementById('fc-uz').textContent = card.uz;
            document.getElementById('flashcard-counter').textContent = `So'z ${currentFlashcard + 1} / ${vocabData.length}`;
            
            isFlipped = false;
            document.getElementById('flashcard-inner').classList.remove('rotate-y-180');

            document.getElementById('btn-prev').disabled = currentFlashcard === 0;
            document.getElementById('btn-next').disabled = currentFlashcard === vocabData.length - 1;
        }

        function toggleFlip() {
            isFlipped = !isFlipped;
            const inner = document.getElementById('flashcard-inner');
            if(isFlipped) inner.classList.add('rotate-y-180');
            else inner.classList.remove('rotate-y-180');
        }

        function nextCard() {
            if (currentFlashcard < vocabData.length - 1) {
                currentFlashcard++; updateFlashcard();
            }
        }

        function prevCard() {
            if (currentFlashcard > 0) {
                currentFlashcard--; updateFlashcard();
            }
        }

        // --- Render Dialogues ---
        function renderDialogues() {
            const container = document.getElementById('dialogues');
            let html = '';
            dialoguesData.forEach(d => {
                html += `
                <div class="bg-white rounded-xl p-6 mb-6 shadow-sm border-l-4 border-green-500">
                    <h3 class="text-xl font-bold text-green-800 mb-4 pb-2 border-b-2 border-gray-100">${d.title}</h3>
                    <div class="space-y-4">
                `;
                d.lines.forEach(l => {
                    html += `
                        <div class="flex gap-3 sm:gap-4">
                            <div class="w-10 h-10 shrink-0 bg-green-500 text-white rounded-full flex items-center justify-center font-bold shadow-sm mt-1">
                                ${l.s}
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg flex-1 border border-gray-100 relative pr-12">
                                <button onclick="playAudio('${l.zh.replace(/'/g, "\\'")}')" class="absolute top-4 right-3 text-gray-400 hover:text-green-600 transition-colors bg-white rounded-full p-1.5 shadow-sm border border-gray-200" title="Tinglash (Play)">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5 10v4a2 2 0 002 2h2.586l3.707 3.707a1 1 0 001.707-.707V5.414a1 1 0 00-1.707-.707L9.586 10H7a2 2 0 00-2 2z" />
                                    </svg>
                                </button>
                                
                                <p class="text-lg text-gray-900 mb-1 font-medium">${l.zh}</p>
                                <p class="text-sm text-gray-500 mb-3 pb-3 border-b border-gray-200">${l.py}</p>
                                
                                <div class="space-y-2">
                                    <div class="flex items-start gap-2">
                                        <span class="text-[10px] font-bold text-white bg-blue-500 px-1.5 py-0.5 rounded leading-none mt-0.5 shrink-0">UZ</span>
                                        <p class="text-sm text-gray-700 italic leading-snug">${l.uz}</p>
                                    </div>
                                    <div class="flex items-start gap-2">
                                        <span class="text-[10px] font-bold text-white bg-red-500 px-1.5 py-0.5 rounded leading-none mt-0.5 shrink-0">RU</span>
                                        <p class="text-sm text-gray-700 italic leading-snug">${l.ru}</p>
                                    </div>
                                    <div class="flex items-start gap-2">
                                        <span class="text-[10px] font-bold text-white bg-indigo-500 px-1.5 py-0.5 rounded leading-none mt-0.5 shrink-0">EN</span>
                                        <p class="text-sm text-gray-700 italic leading-snug">${l.en}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                html += `</div></div>`;
            });
            container.innerHTML = html;
        }

        // --- Render Grammar ---
        function renderGrammar() {
            const container = document.getElementById('grammar');
            let html = '';
            grammarData.forEach(g => {
                html += `
                <div class="bg-white rounded-xl p-5 sm:p-6 mb-6 shadow-sm border-t-4 border-green-500">
                    <h3 class="text-xl font-bold text-green-800 mb-4">${g.title}</h3>
                    
                    <div class="space-y-4 mb-6">
                        <div class="flex gap-3 items-start">
                            <span class="text-xs font-bold text-white bg-blue-500 px-2 py-1 rounded shrink-0 mt-1">UZ</span>
                            <p class="text-gray-700 leading-relaxed text-sm sm:text-base">${g.descUz}</p>
                        </div>
                        <div class="flex gap-3 items-start">
                            <span class="text-xs font-bold text-white bg-red-500 px-2 py-1 rounded shrink-0 mt-1">RU</span>
                            <p class="text-gray-700 leading-relaxed text-sm sm:text-base">${g.descRu}</p>
                        </div>
                        <div class="flex gap-3 items-start">
                            <span class="text-xs font-bold text-white bg-indigo-500 px-2 py-1 rounded shrink-0 mt-1">EN</span>
                            <p class="text-gray-700 leading-relaxed text-sm sm:text-base">${g.descEn}</p>
                        </div>
                    </div>

                    <div class="space-y-2 mt-4 pt-4 border-t border-gray-100">
                `;
                g.examples.forEach(ex => {
                    html += `
                        <div class="bg-green-50 border-l-4 border-green-400 p-3 text-gray-800 rounded-r-lg font-medium">
                            ${ex}
                        </div>
                    `;
                });
                html += `</div></div>`;
            });
            container.innerHTML = html;
        }

        // --- Single Question Quiz Engine ---
        function startQuiz(type, reset = true) {
            currentQuizType = type;
            if(reset) {
                quizState[type].currentIdx = 0;
                quizState[type].score = 0;
                quizState[type].answered = false;
            }
            renderQuiz();
        }

        function renderQuiz() {
            const type = currentQuizType;
            const state = quizState[type];
            const data = type === 'vocab' ? vocabTestData : compTestData;
            const container = document.getElementById(`${type}-test-container`);
            
            // Check if test is finished
            if(state.currentIdx >= data.length) {
                container.innerHTML = `
                    <div class="text-center bg-white p-8 rounded-2xl shadow-xl border-4 border-green-500 animate-fade-in">
                        <h3 class="text-3xl font-bold text-green-800 mb-4">Natija: ${state.score} / ${data.length}</h3>
                        <p class="text-lg text-gray-600 mb-6">${state.score === data.length ? "Zo'r! Siz barcha savollarga to'g'ri javob berdingiz! üéâ" : "Yaxshi natija! Yana ozgina harakat qiling. üëç"}</p>
                        <button onclick="startQuiz('${type}', true)" class="bg-green-100 hover:bg-green-200 text-green-800 font-bold py-3 px-8 rounded-xl border border-green-300 transition-colors shadow-sm">Qayta ishlash (Retry)</button>
                    </div>
                `;
                return;
            }

            const q = data[state.currentIdx];
            state.answered = false;

            let html = `
                <div class="bg-white rounded-xl p-6 sm:p-8 shadow-md border-t-4 border-green-500 animate-fade-in">
                    <!-- Progress Bar -->
                    <div class="mb-6">
                        <div class="flex justify-between text-sm text-green-700 font-bold mb-2">
                            <span>Savol ${state.currentIdx + 1} / ${data.length}</span>
                            <span>To'g'ri: ${state.score}</span>
                        </div>
                        <div class="w-full bg-green-100 rounded-full h-2.5">
                          <div class="bg-green-500 h-2.5 rounded-full transition-all duration-300" style="width: ${(state.currentIdx / data.length) * 100}%"></div>
                        </div>
                    </div>
                    
                    <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-6 leading-snug">${q.q}</h3>
                    
                    <!-- Options -->
                    <div class="space-y-3">
            `;

            q.opts.forEach((opt, oIndex) => {
                html += `
                    <button id="opt-${type}-${oIndex}" onclick="selectAnswer(${oIndex})" class="w-full text-left p-4 rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 transition-all text-lg font-medium text-gray-700 block">
                        <span class="inline-block w-8 font-bold text-green-600">${String.fromCharCode(65 + oIndex)})</span> ${opt}
                    </button>
                `;
            });

            html += `
                    </div>
                    
                    <!-- Next Button (Hidden initially) -->
                    <div id="next-btn-container-${type}" class="mt-8 hidden text-center">
                        <button onclick="nextQuizQuestion()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg transition-transform hover:scale-105 w-full sm:w-auto text-lg">Keyingi savol (Next)</button>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function selectAnswer(selectedIndex) {
            const type = currentQuizType;
            const state = quizState[type];
            if(state.answered) return;
            state.answered = true;

            const data = type === 'vocab' ? vocabTestData : compTestData;
            const q = data[state.currentIdx];

            // Evaluate buttons
            q.opts.forEach((_, idx) => {
                const btn = document.getElementById(`opt-${type}-${idx}`);
                btn.disabled = true;
                btn.classList.remove('hover:border-green-500', 'hover:bg-green-50', 'border-gray-200');
                
                if(idx === q.ans) {
                    btn.classList.add('border-green-500', 'bg-green-100', 'text-green-900'); // Correct
                } else if (idx === selectedIndex) {
                    btn.classList.add('border-red-400', 'bg-red-50', 'text-red-800'); // Wrong Selection
                } else {
                    btn.classList.add('border-gray-100', 'opacity-50'); // Others disabled
                }
            });

            if(selectedIndex === q.ans) {
                state.score++;
            }

            document.getElementById(`next-btn-container-${type}`).classList.remove('hidden');
            
            // Auto scroll slightly to ensure NEXT button is visible on small screens
            setTimeout(() => {
                const btnContainer = document.getElementById(`next-btn-container-${type}`);
                btnContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        function nextQuizQuestion() {
            const type = currentQuizType;
            quizState[type].currentIdx++;
            renderQuiz();
            document.getElementById('main-content').scrollTop = 0;
        }

        // Initialize App
        window.onload = init;
    </script>
</body>
</html>